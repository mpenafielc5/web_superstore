{% extends "dashboard/base.html" %}
{% load static %}

{% block header %}Superstore — Dashboard{% endblock %}

{% block content %}
<div id="filtersCollapse" class="collapse">
<div class="card mb-3">
  <div class="card-body">
    <form id="filters" class="row g-2 align-items-end">
      <div class="col-sm-6 col-md-2">
        <label class="form-label"><i class="ti ti-calendar me-1"></i>Desde</label>
        <input type="text" name="date_from" class="form-control" placeholder="Selecciona fecha">
      </div>
      <div class="col-sm-6 col-md-2">
        <label class="form-label"><i class="ti ti-calendar-event me-1"></i>Hasta</label>
        <input type="text" name="date_to" class="form-control" placeholder="Selecciona fecha">
      </div>
      <div class="col-sm-6 col-md-3">
        <label class="form-label"><i class="ti ti-category me-1"></i>Categoría</label>
        <select name="category" id="category" class="form-select">
          <option value="">(Todas)</option>
        </select>
      </div>
      <div class="col-sm-6 col-md-3">
        <label class="form-label"><i class="ti ti-category-2 me-1"></i>Subcategoría</label>
        <select name="sub_category" id="sub_category" class="form-select">
          <option value="">(Todas)</option>
        </select>
      </div>
      <div class="col-sm-6 col-md-2">
        <label class="form-label"><i class="ti ti-map-pin me-1"></i>Estado</label>
        <select name="state" id="state" class="form-select">
          <option value="">(Todos)</option>
        </select>
      </div>
      <div class="col-sm-6 col-md-2">
        <label class="form-label"><i class="ti ti-building me-1"></i>Ciudad</label>
        <select name="city" id="city" class="form-select">
          <option value="">(Todas)</option>
        </select>
      </div>
      <div class="col-12 mt-1">
        <button class="btn btn-primary">
          <i class="ti ti-filter me-1"></i>Aplicar filtros
        </button>
        <button class="btn btn-outline-secondary" type="button" id="clearFilters">
          <i class="ti ti-eraser me-1"></i>Limpiar
        </button>
        <button class="btn btn-success" type="button" id="exportExcel">
          <i class="ti ti-file-spreadsheet me-1"></i>Exportar Excel
        </button>
      </div>
    </form>

    <div id="activeFilters" class="mt-3"></div>
  </div>
</div>
</div>

<div class="row row-cards mb-3">
  <div class="col-md-4">
    <div class="card card-stacked">
      <div class="card-body text-center">
        <div class="text-muted"><i class="ti ti-currency-dollar me-1"></i>Total ventas</div>
        <div id="kpiTotal" class="kpi-number" aria-live="polite">$0,00</div>
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="card card-stacked">
      <div class="card-body">
        <div class="text-muted mb-2"><i class="ti ti-tags me-1"></i>Ventas por segmento</div>
        <ul class="list-group list-group-flush" id="kpiSegment"></ul>
      </div>
    </div>
  </div>
</div>

<div class="row row-cards mb-3">
  <div class="col-md-8">
    <div class="card card-stacked">
      <div class="card-body">
        <div class="text-muted mb-2"><i class="ti ti-chart-line me-1"></i>Fecha vs Venta</div>
        <div class="chart-box"><canvas id="lineSales"></canvas></div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card card-stacked">
      <div class="card-body">
        <div class="text-muted mb-2"><i class="ti ti-chart-pie me-1"></i>Ventas por categoría</div>
        <div class="chart-box-sm"><canvas id="pieCategory"></canvas></div>
        <div id="legendCategory" class="mt-2"></div>
      </div>
    </div>
  </div>
</div>

<div class="row row-cards">
  <div class="col-lg-6">
    <div class="card card-stacked">
      <div class="card-body">
        <div class="text-muted mb-2"><i class="ti ti-users me-1"></i>Top 10 clientes por venta</div>
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th><i class="ti ti-user me-1"></i>Cliente</th>
                <th><i class="ti ti-tag me-1"></i>Segmento</th>
                <th><i class="ti ti-building me-1"></i>Ciudad</th>
                <th><i class="ti ti-map me-1"></i>Estado</th>
                <th class="text-end"><i class="ti ti-currency-dollar me-1"></i>Total</th>
              </tr>
            </thead>
            <tbody id="tblCustomers"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card card-stacked">
      <div class="card-body">
        <div class="text-muted mb-2"><i class="ti ti-package-export me-1"></i>Top 20 productos más vendidos</div>
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th><i class="ti ti-barcode me-1"></i>ID</th>
                <th><i class="ti ti-category me-1"></i>Categoría</th>
                <th><i class="ti ti-category-2 me-1"></i>Subcategoría</th>
                <th><i class="ti ti-box me-1"></i>Producto</th>
                <th class="text-end"><i class="ti ti-currency-dollar me-1"></i>Ventas</th>
              </tr>
            </thead>
            <tbody id="tblProducts"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'dashboard/app.js' %}"></script>
{% endblock %}
